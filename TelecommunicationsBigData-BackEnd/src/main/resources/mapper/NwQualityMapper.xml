<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.bigdata.dao.NwQualityMapper">

    <select id="getStatistics" resultType="com.bigdata.model.entity.NetworkQuality.NwQualityStatistics">
        SELECT
        NWOPERATOR,
        NWTYPE,
        AVG(ULSPEED) AS SPEED
        FROM
            NWQUALITY
        <where>
            <if test="nwOperator != null">AND NWOPERATOR = #{nwOperator}</if>
            <if test="nwType != null">AND NWTYPE = #{nwType} </if>
            <if test="startDate != null and startDate != 0">AND DAYTIME &gt; #{startDate} </if>
            <if test="endDate != null and endDate != 0">AND DAYTIME &lt; #{endDate}</if>
        </where>
        GROUP BY
            NWOPERATOR, NWTYPE
        ORDER BY
            NWOPERATOR, NWTYPE
    </select>

    <select id="getRanks" resultType="com.bigdata.model.entity.NetworkQuality.NwSpeedRank">
        SELECT
            PROVINCE,
            NWOPERATOR,
        <choose>
            <when test="speedType == 'ulspeed'">
                AVG(ULSPEED) AS SPEED
            </when>
            <when test="speedType == 'dlspeed'">
                AVG(DLSPEED) AS SPEED
            </when>
            <when test="speedType == 'latency'">
                AVG(LATENCY) AS SPEED
            </when>
            <otherwise>
                AVG(ULSPEED) AS SPEED
            </otherwise>
        </choose>
        FROM
            NWQUALITY
        <where>
            <if test="nwOperator != null">AND NWOPERATOR = #{nwOperator}</if>
            <if test="startDate != null and startDate != 0">AND DAYTIME &gt; #{startDate} </if>
            <if test="endDate != null and endDate != 0">AND DAYTIME &lt; #{endDate}</if>
        </where>
        GROUP BY
            PROVINCE, NWOPERATOR
        ORDER BY
            PROVINCE ASC, NWOPERATOR ASC

    </select>
    <select id="getTypicalTracking"
            resultType="com.bigdata.model.entity.NetworkQuality.TypicalNWQualityTracking">
        SELECT
            SUBSTR(TO_CHAR(DAYTIME,'#'), 7, 2) AS x_rate,
            NWOPERATOR,
        <choose>
            <when test="speedType == 'ulspeed'">
                AVG(ULSPEED) AS SPEED
            </when>
            <when test="speedType == 'dlspeed'">
                AVG(DLSPEED) AS SPEED
            </when>
            <when test="speedType == 'latency'">
                AVG(LATENCY) AS SPEED
            </when>
            <otherwise>
                AVG(ULSPEED) AS SPEED
            </otherwise>
        </choose>
        FROM
            NWQUALITY
        <where>
            <if test="nwOperator != null ">AND NWOPERATOR = #{nwOperator}</if>
            <if test="nwType != null">AND NWTYPE = #{nwType}</if>
            <if test="landmark != null">AND LANDMARK = #{landmark}</if>
            <if test="startDate != null and startDate != 0">AND DAYTIME &gt; #{startDate} </if>
            <if test="endDate != null and endDate != 0">AND DAYTIME &lt; #{endDate}</if>
        </where>
        GROUP BY
            NWOPERATOR,
            SUBSTR(TO_CHAR(DAYTIME,'#'), 7, 2)
    </select>
    <select id="getLandmarkStatistics"
            resultType="com.bigdata.model.entity.NetworkQuality.TypicalNWQualityStatistics">
        SELECT
            NWOPERATOR,
            LANDMARK,
        <choose>
            <when test="speedType == 'ulspeed'">
                AVG(ULSPEED) AS SPEED
            </when>
            <when test="speedType == 'dlspeed'">
                AVG(DLSPEED) AS SPEED
            </when>
            <when test="speedType == 'latency'">
                AVG(LATENCY) AS SPEED
            </when>
            <otherwise>
                AVG(ULSPEED) AS SPEED
            </otherwise>
        </choose>
        FROM
            NWQUALITY
        <where>
            <if test="nwOperator != null ">AND NWOPERATOR = #{nwOperator}</if>
            <if test="nwType != null">AND NWTYPE = #{nwType}</if>
            <if test="startDate != null and startDate != 0">AND DAYTIME &gt; #{startDate} </if>
            <if test="endDate != null and endDate != 0">AND DAYTIME &lt; #{endDate}</if>
        </where>
        GROUP BY
            NWOPERATOR,
            LANDMARK
        ORDER BY
            NWOPERATOR ASC,
            LANDMARK ASC
    </select>
</mapper>